<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>TashiTalk</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!-- <script src="../siteWideResources/jquery-2.2.2.min.js"></script> -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
    <link rel="stylesheet" href="resources/css/style.css">
    <link rel="stylesheet" href="../siteWideResources/animate.css">
    <script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>
	<script src="https://cdn.webrtc-experiment.com/gumadapter.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script> -->
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <script type='text/javascript' src="../siteWideResources/jquery-2.2.2.min.js"></script>
	<script type='text/javascript' src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!--     <script src="script.js"></script> -->
      
<!--     Record RTC Javascript-->
     <script>
		var recordRTC;
		var cameraStream;
		var streamStarted = false;
		var currentAttempt = 1;

		function btnStartRecording() {
		    // RecordRTC usage goes here
		    if (streamStarted){	
			    var options = {
			      mimeType: 'video/webm', // or video/mp4 or audio/ogg
			      audioBitsPerSecond: 128000,
			      videoBitsPerSecond: 128000,
			      bitsPerSecond: 128000 // if this line is provided, skip above two
			    };
			    recordRTC = RecordRTC(cameraStream, options);
			    recordRTC.startRecording();
			}
		}
         
        function successCallback(stream) {
                var videoStream = document.getElementById("streamWebcam");
                videoStream.src = window.URL.createObjectURL(stream);
                cameraStream = stream;
                streamStarted = true;
        }

		function errorCallback(error) {
		    // maybe another application is using the device
		}

		var mediaConstraints = { video: true, audio: true };

		navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);

		function btnStopRecordingFirst () {
				           
		    recordRTC.stopRecording(function (audioVideoWebMURL) {
		        //video.src = audioVideoWebMURL;
		        var recordedBlob = recordRTC.getBlob();
		        recordRTC.getDataURL(function(dataURL) { });
		        if (currentAttempt == 1){
		            var playerOne = document.getElementById("attemptOnePlayer");
					playerOne.src = window.URL.createObjectURL(recordedBlob);
					currentAttempt = 2;
				}
				else if (currentAttempt == 2){
		            var playerTwo = document.getElementById("attemptTwoPlayer");
					playerTwo.src = window.URL.createObjectURL(recordedBlob);
					currentAttempt = 3;
				}
				else if (currentAttempt == 3){
		            var playerThree = document.getElementById("attemptThreePlayer");
					playerThree.src = window.URL.createObjectURL(recordedBlob);
					currentAttempt = 4;
				}

				var attemptOneBlob = new Blob ([recordedBlob]);
		   		// uploadAudio(videoBlob);
		    });

		};

		// function uploadAudio( blob ) {
		//   var reader = new FileReader();
		//   reader.onload = function(event){
		//     var fd = {};
		//     fd["fname"] = "test.wav";
		//     fd["data"] = event.target.result;
		//     $.ajax({
		//       type: 'POST',
		//       url: 'uploader.php',
		//       data: fd,
		//       dataType: 'text'
		//     }).done(function(data) {
		//         console.log(data);
		//     });
		//   };
		//   reader.readAsDataURL(blob);
		// }
    </script>
      
      
  </head>
  <body>

  	<!-- Nav bar -->

	 <div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="container-fluid">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a class="navbar-brand" href="#">Logo-</a>
	    </div>
	    <div class="collapse navbar-collapse">
	      <ul class="nav navbar-nav navbar-right">
              
	      <!-- Active tab code -->
               <li role="presentation" class="active"><a href="#">Messages <span class="badge">8</span></a></li>
	<!--       <li class="active"> -->
	        <li><a href="#chat">Chat Partners</a></li>

	        <li><a href="#lessons">Lessons</a></li>
	        <li><a href="#prompts">Prompts</a></li>


              
<!--              Dropdown-->
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Options <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Option</a></li>
                <li><a href="#">Another option</a></li>
                <li><a href="#">More options</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Other options</a></li>
                <li><a href="#">Settings</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Log out</a></li>
              </ul>
                
            </li>
	      </ul>
	    </div><!--/.nav-collapse -->
	  </div>
	</div>

      
<!--      Present Prompt     -->
<div class="container" >
  
  <div class="text-center" >
    <h1>Schedule Prompt 1</h1>
  </div>
<div class="row">
  <div class="col-sm-6">
    <img class="img-responsive pull-right" src="../uploadedMaterial/teachers/promptPicture.png" alt="Attempt 1">
  </div>
  <div class="col-sm-6">
    <h4 class="media-heading">Instructions:</h4>
    Greet Tanakasan (person A) and tell him what you are doing Wednesday at 6:30PM, Monday next week and Wednesday the week after.

    <br>
    <br>
    <button type="button" class="btn btn-warning" onclick="btnStartRecording()">Record Response</button>
    <button type="button" class="btn btn-success" onclick="btnStopRecordingFirst()">End Recording</button>
    <video id="streamWebcam" muted class="scaling-video" autoplay="true" src=""></video>
  </div>
</div>
    

    
</div><!-- /.container -->


<!--      Main Site Options-->
<div class="container">
	<div class="row">
	    <div class="col-sm-4">
	    	<div class="well switchboard">Attempt 1 of 3
            <video id="attemptOnePlayer" class="scaling-video-sm" controls src=""></video>
            <button type="button" class="btn btn-primary">Submit this Attempt</button>
            </div>
	    </div>
	    <div class="col-sm-4">
	    	<div class="well switchboard">Attempt 2 of 3
	    	<video id="attemptTwoPlayer" class="scaling-video-sm" controls src=""></video>
            <button type="button" class="btn btn-primary">Submit this Attempt</button>
	    	</div>

	    </div>
	    <div class="col-sm-4"
>	    	<div class="well switchboard">Attempt 3 of 3
	    	<video id="attemptThreePlayer" class="scaling-video-sm" controls src=""></video>
            <button type="button" class="btn btn-primary">Submit this Attempt</button>
	    	</div>
	    </div>
	</div>
</div>

  </body>
</html>